@model IEnumerable<StudentGradingSystem.Models.Student>
<br />
<p>
    <button type="button" style="border:none" class="btn btn-primary" onclick="createStudent()">Create</button>
</p>


<table id="studtable_id" class="table table-striped table-bordered dt-responsive nowrap">
    <thead style="background-color: #1C2833; color: white">
        <tr>
            <th>Register Number</th>
            <th>Name</th>
            <th>Date Of Birth</th>
            <th>Standard</th>
            <th>Mathematics</th>
            <th>Physics</th>
            <th>Chemistry</th>
            <th>Overall Grade</th>
            <th>Actions</th>
        </tr>
    </thead>
</table>


<div class="modal fade" id="dataModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="ModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:37%" role="document">
        <div class="modal-content" id="dataModalBody">


        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


<script>
   
    var dataTable;
    $(document).ready(function () {
        dataTable = $('#studtable_id').DataTable({
            "ajax": {
                url: "/Student/GetData",
                type: "POST",
                dataType: "json"
            },
            columns: [
                { 'data': 'Regnum', 'name': "Regnum" },
                { 'data': 'Name', 'name': "Name" },
                {
                    'data': 'Dob', 'name': "Dob", "type": "DateTime",
                    "render": function (value) {
                        if (value === null) return "";
                        var pattern = /Date\(([^)]+)\)/;
                        var results = pattern.exec(value);
                        var dt = new Date(parseFloat(results[1]));
                        return dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear()
                    }
                },
                { 'data': 'Standard', 'name': "Standard" },
                { 'data': 'Mathematics', 'name': "Mathematics" },
                { 'data': 'Physics', 'name': "Physics" },
                { 'data': 'Chemistry', 'name': "Chemistry" },
                { 'data': 'Grade', 'name': "Grade" },
                {
                    'data': 'Id', 'render': function (data) {
                        return '<button class="btn btn-info" onclick="getStudent(' + data + ')" >View</button> <button class="btn btn-warning" onclick="editGetStudent(' + data + ')" >Edit</button>  <button class="btn btn-danger" onclick="Delete(' + data + ')"> Delete</button>';
                    }
                }
            ],

            "serverSide": true,
            "order": [0, "asc"],
            "processing": true,           
            "columnDefs": [{ "width": "15%", "targets": [0, 3, 4, 5, 6] }, {
                'targets': [8],
                'orderable': false,

            }],
           
        });
       
        
    });


    function createStudent() {
        $.get("/Student/Create", { operation: "Add" }, function (res) {
            $('#dataModalBody').html(res);
            document.getElementById("dob").type = "date";
            $('#dob').keypress(function (event) {
                event.preventDefault();
                return false;
            });
            $('#reg').attr('readonly', false);

            document.getElementById("ViewModalLabel").innerHTML = "CREATE STUDENT";
            $("#maths").val("");
            $("#physics").val("");
            $("#chemistry").val("");
            $("#btnSave").show();
            $('#dataModal').modal('show');
            btnEdit.style.visibility = 'hidden';
        })
    }

   
    function getStudent(id) {
        $.get("/Student/Edit", { operation: "View", id: id }, function (res) {
            $('#dataModalBody').html(res);
            $('#dob').keypress(function (event) {
                event.preventDefault();
                return false;
            });
            $('#dataModal').modal('show');
        })
    }

    function editGetStudent(id) {
        $.get("/Student/Edit", { operation: "Edit", id: id }, function (res) {
            $('#dataModalBody').html(res);
            $("#btnUpdateSave").show();
            $('#dob').keypress(function (event) {
                event.preventDefault();
                return false;
            });
            $('#reg').keypress(function (event) {
                event.preventDefault();
                return false;
            });
            btnEdit.style.visibility = 'hidden';
            document.getElementById("ViewModalLabel").innerHTML = "EDIT STUDENT";
            $('#dataModal').modal('show');
        })
    }

    function Delete(id) {
        $.get("/Student/Delete", { id: id }, function (res) {
            if (res) {
                $('#dataModalBody').html(res);
                $('#dataModal').modal('show');
                dataTable.ajax.reload();
            }
        })
    }

</script>
