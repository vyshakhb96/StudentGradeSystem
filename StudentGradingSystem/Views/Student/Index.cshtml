@model IEnumerable <StudentGradingSystem.Models.Student>
<br />

<p>
    @*@Html.ActionLink("Add New Student", "Create", "Student", new { @class = "btn btn-success" })*@
    <button type="button" class="btn btn-primary" onclick="createStudent()">Create</button>
</p>


<table id="studtable_id" class="table table-striped table-bordered dt-responsive nowrap">
    <thead style="background-color: #1C2833; color: white">
        <tr>
            <th>Register Number</th>
            <th>Name</th>
            <th>Date of Birth</th>
            <th>Standard</th>
            <th>Mathematics</th>
            <th>Physics</th>
            <th>Chemistry</th>
            <th>Overall Grade</th>
            <th>Actions</th>
        </tr>
    </thead>
</table>


    <div class="modal fade" id="dataModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" id="dataModalBody">


            </div>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
    <script>
        var dataTable;
        $(document).ready(function () {
            dataTable = $('#studtable_id').DataTable({
                "ajax": {
                    url: "/Student/GetData",
                    type: "POST",
                    dataType: "json"
                },
                columns: [
                    { 'data': 'Regnum', 'name': "Regnum" },
                    { 'data': 'Name', 'name': "Name" },
                    { 'data': 'Dob', 'name': "Dob" },
                    { 'data': 'Standard', 'name': "Standard" },
                    { 'data': 'Mathematics', 'name': "Mathematics" },
                    { 'data': 'Physics', 'name': "Physics" },
                    { 'data': 'Chemistry', 'name': "Chemistry" },
                    { 'data': 'Grade', 'name': "Grade" },
                    {
                        'data': 'Id', 'render': function (data) {
                            return '<button class="btn btn-warning" onclick="getStudent(' + data + ')" >View</button>  <button class="btn btn-danger" onclick="Delete(' + data + ')"> Delete</button>';
                        }
                    }
                ],
                "serverSide": "true",
                "order": [0, "asc"],
                "processing": "true"
            });
        });


        function createStudent() {
            $.get("/Student/Create", { operation:"Add"}, function (res) {
                $('#dataModalBody').html(res);
                $('#dataModal').modal('show');
                document.getElementById("dob").type = "date";
                btnEdit.style.visibility = 'hidden';
                document.getElementById("ViewModalLabel").innerHTML = "CREATE STUDENT";
                $("#btnSave").show();

            })
        }

        function AddStudent() {
            var modal = $("#dataModal");
            var form = $('form[name="dataForm"]');
            studentValidation();
            var data = form.serialize();
            $.post("/Student/Create", data, function (res) {
                if (res) {
                    modal.modal('hide');
                    dataTable.ajax.reload();
                }
            })
        }

        function getStudent(id) {
            $.get("/Student/Edit", { operation:"View", id: id }, function (res) {
                $('#dataModalBody').html(res);
                $('#dataModal').modal('show');
            })
        }

        function UpdateStudent() {
            var modal = $("#dataModal");
            var form = $('form[name="dataForm"]');
            studentValidation();
            var data = form.serialize();
            $.post("/Student/Edit", data, function (res) {
                if (res) {
                    modal.modal('hide');
                    dataTable.ajax.reload();
                }
            })
        }

        function Delete(id) {
            $.get("/Student/Delete", { id: id }, function (res) {
                if (res) {
                    $('#dataModalBody').html(res);
                    $('#dataModal').modal('show');
                    dataTable.ajax.reload();
                }
            })
        }

        function DeleteStudent() {
            var modal = $("#dataModal");
            var form = $('form[name="deleteForm"]');
            var data = form.serialize();
            $.post("/Student/Delete", data, function (res) {
                if (res) {
                    modal.modal('hide');
                    dataTable.ajax.reload();
                }
            })
        }

        function enable() {
            $('.form-control').attr('disabled', false);           
            btnEdit.style.visibility = 'hidden';
            $("#btnUpdateSave").show();
            document.getElementById("ViewModalLabel").innerHTML = "EDIT STUDENT";
        }

        function studentValidation() {
            if (document.getElementById("reg").value == "") {
                document.getElementById("regSpan").textContent = "Register number is required";
            } else {
                document.getElementById("regSpan").textContent = "";
            }

            var name = document.getElementById("name").value;
            if (name == "") {
                document.getElementById("spanName").textContent = "Name is required";
            } else if (Number.isInteger(name)) {
                document.getElementById("spanName").textContent = "Enter proper name";
            } else {
                document.getElementById("spanName").textContent = "";
            }

            var dateOfBirth = document.getElementById("dob").value;
            if (dateOfBirth == "") {
                document.getElementById("spanDob").textContent = "Date of birth is required";
            } else {
                document.getElementById("spanDob").textContent = "";
            }

            var standard = $("#Standard").val();
            if (standard.length <= 0) {
                document.getElementById("spanStandard").textContent = "Please select a standard";
            } else {
                document.getElementById("spanStandard").textContent = "";
            }

            var Maths = $("#maths").val();
            if (Maths > 100 || Maths < 0) {
                document.getElementById("spanMaths").textContent = "Enter proper marks";
            } else {
                document.getElementById("spanMaths").textContent = "";
            }

            var Phy = $("#physics").val();
            if (Phy > 100 || Phy < 0) {
                document.getElementById("spanPhysics").textContent = "Enter proper marks";
            } else {
                document.getElementById("spanPhysics").textContent = "";
            }

            var Che = $("#chemistry").val();
            if (Che > 100 || Che < 0) {
                document.getElementById("spanChemistry").textContent = "Enter proper marks";
            } else {
                document.getElementById("spanChemistry").textContent = "";
            }

        }

    </script>
